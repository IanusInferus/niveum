$Comment
    ==========================================================================

      File:        Haxe.tree
      Location:    Yuki.Core <Tree>
      Description: 对象类型结构Haxe模板
      Version:     2016.10.06.
      Copyright(C) F.R.C.

    ==========================================================================

#Option
    EnableEmbeddedExpr True

#Namespace Yuki.ObjectSchema.Haxe

#Import
    System
    System.Collections.Generic
    System.Linq

#Constant Keywords:List<String>
    $List String
        abstract
        break
        callback
        case
        cast
        catch
        class
        continue
        default
        do
        dynamic
        else
        enum
        extends
        extern
        false
        for
        function
        here
        if
        implements
        import
        in
        inline
        interface
        never
        new
        null
        override
        package
        private
        public
        return
        static
        super
        switch
        this
        throw
        trace
        true
        try
        typedef
        untyped
        using
        var
        while
        Dynamic

#Constant PrimitiveMapping:Map<String, String>
    $Table KeyValuePairOfStringAndString Key Value
        Unit                Unit
        Boolean             Bool
        String              String
        Int                 Int
        Real                Float
        Byte                Int
        UInt8               Int
        UInt16              Int
        UInt32              Int
        UInt64              haxe.Int64
        Int8                Int
        Int16               Int
        Int32               Int
        Int64               haxe.Int64
        Float32             Float
        Float64             Float
        Type                Error
        Optional            Null
        List                Array
        Set                 Set
        Map                 Map

#Template SingleLineXmlComment Description:String
    /** ${Description} */

#Template MultiLineXmlComment Description:List<String>
    /**
      * ${Description}
      * */

#Template Primitive Name:String PlatformName:String
    typedef [[${Name}]] = ${PlatformName}

#Template Primitive_Unit
    typedef Unit = {}

#Template Primitive_Set
    typedef Set<T> = Map<T, Unit>

#Template Alias a:AliasDef
    $$
        var Name = GetEscapedIdentifier(a.TypeFriendlyName()) + GetGenericParameters(a.GenericParameters);
        var Type = GetTypeString(a.Type);
    ${GetXmlComment(a.Description)}
    typedef ${Name} = ${Type}

#Template Record r:RecordDef
    $$
        var Name = GetEscapedIdentifier(r.TypeFriendlyName()) + GetGenericParameters(r.GenericParameters);
    ${GetXmlComment(r.Description)}
    typedef [[${Name}]] =
    {
        $$
            foreach (var f in r.Fields)
            {
                ##
                    ${GetXmlComment(f.Description)}
                    var [[${LowercaseCamelize(f.Name)}]] : ${GetTypeString(f.Type)};
            }
    }

#Template TaggedUnion tu:TaggedUnionDef
    $$
        var Name = GetEscapedIdentifier(tu.TypeFriendlyName()) + GetGenericParameters(tu.GenericParameters);
    ${GetXmlComment(tu.Description)}
    enum ${Name}
    {
        $$
            foreach (var a in tu.Alternatives)
            {
                if (a.Type.OnTypeRef && (a.Type.TypeRef.Name == "Unit") && (a.Type.TypeRef.Version == ""))
                {
                    ##
                        ${GetXmlComment(a.Description)}
                        [[${LowercaseCamelize(a.Name)}]];
                }
                else
                {
                    ##
                        ${GetXmlComment(a.Description)}
                        [[${LowercaseCamelize(a.Name)}]](v : ${GetTypeString(a.Type)});
                }
            }
    }

#Template Enum e:EnumDef
    $$
        var Name = GetEscapedIdentifier(e.TypeFriendlyName());
    ${GetXmlComment(e.Description)}
    class ${Name} /* ${GetEnumTypeString(e.UnderlyingType)} */
    {
        $$
            var k = 0;
            foreach (var l in e.Literals)
            {
                ##
                    ${GetXmlComment(l.Description)}
                    public static inline var [[${l.Name.ToUpperInvariant()}]] : ${GetTypeString(e.UnderlyingType)} = ${l.Value};
                k += 1;
            }
    }

#Template ClientCommand c:ClientCommandDef
    $$
        var Request = new RecordDef { Name = c.TypeFriendlyName() + "Request", Version = "", GenericParameters = new List<VariableDef> { }, Fields = c.OutParameters, Attributes = c.Attributes, Description = c.Description };
        var Reply = new TaggedUnionDef { Name = c.TypeFriendlyName() + "Reply", Version = "", GenericParameters = new List<VariableDef> { }, Alternatives = c.InParameters, Attributes = c.Attributes, Description = c.Description };
    ${Record(Request)}
    ${TaggedUnion(Reply)}

#Template ServerCommand c:ServerCommandDef
    $$
        var Event = new RecordDef { Name = c.TypeFriendlyName() + "Event", Version = "", GenericParameters = new List<VariableDef> { }, Fields = c.OutParameters, Attributes = c.Attributes, Description = c.Description };
    ${Record(Event)}

#Template Tuple tp:TypeSpec
    $$
        var Name = GetEscapedIdentifier(tp.TypeFriendlyName());
        var Types = tp.Tuple;
    /* Tuple */
    typedef ${Name} =
    {
        $$
            var k = 0;
            foreach (var e in Types)
            {
                ##
                    var [[item${k}]] : ${GetTypeString(e)};
                k += 1;
            }
    }

#Template IApplicationClient Commands:List<TypeDef>
    interface IApplicationClient
    {
        var hash(get, null) : String;
        function dequeueCallback(commandName : String) : Void;

        $$
            foreach (var c in Commands)
            {
                if (c.OnClientCommand)
                {
                    var Name = c.ClientCommand.TypeFriendlyName();
                    var Description = c.ClientCommand.Description;
                    ##
                        ${GetXmlComment(Description)}
                        function [[${LowercaseCamelize(Name)}]](r : [[${Name}Request]], _callback : [[${Name}Reply]] -> Void) : Void;
                }
                else if (c.OnServerCommand)
                {
                    var Name = c.ServerCommand.TypeFriendlyName();
                    var Description = c.ServerCommand.Description;
                    ##
                        ${GetXmlComment(Description)}
                        var [[${LowercaseCamelize(Name)}]] : [[${Name}Event]] -> Void;
                }
            }
    }

#Template Main Schema:Schema PackageName:String
    //==========================================================================
    //
    //  Notice:      This file is automatically generated.
    //               Please don't modify this file.
    //
    //==========================================================================

    $$
        if (PackageName != "")
        {
            ##
                package [[${PackageName}]];
        }
    import ${Schema.Imports};

    ${GetTypes(Schema)}

$End
