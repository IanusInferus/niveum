//==========================================================================
//
//  Notice:      This file is automatically generated.
//               Please don't modify this file.
//
//==========================================================================

using System;
using System.Collections.Generic;
using System.Linq;
using Firefly;
using Boolean = System.Boolean;
using String = System.String;
using Type = System.Type;
using Int = System.Int32;
using Real = System.Double;
using Byte = System.Byte;
using UInt8 = System.Byte;
using UInt16 = System.UInt16;
using UInt32 = System.UInt32;
using UInt64 = System.UInt64;
using Int8 = System.SByte;
using Int16 = System.Int16;
using Int32 = System.Int32;
using Int64 = System.Int64;
using Float32 = System.Single;
using Float64 = System.Double;

namespace Niveum.ObjectSchema.CppCompatible
{
    partial class Templates
    {
        private IEnumerable<String> Begin()
        {
            yield return "";
        }
        private IEnumerable<String> Combine(IEnumerable<String> Left, String Right)
        {
            foreach (var vLeft in Left)
            {
                yield return vLeft + Right;
            }
        }
        private IEnumerable<String> Combine(IEnumerable<String> Left, Object Right)
        {
            foreach (var vLeft in Left)
            {
                yield return vLeft + Convert.ToString(Right, System.Globalization.CultureInfo.InvariantCulture);
            }
        }
        private IEnumerable<String> Combine(IEnumerable<String> Left, IEnumerable<String> Right)
        {
            foreach (var vLeft in Left)
            {
                foreach (var vRight in Right)
                {
                    yield return vLeft + vRight;
                }
            }
        }
        private IEnumerable<String> Combine<T>(IEnumerable<String> Left, IEnumerable<T> Right)
        {
            foreach (var vLeft in Left)
            {
                foreach (var vRight in Right)
                {
                    yield return vLeft + Convert.ToString(vRight, System.Globalization.CultureInfo.InvariantCulture);
                }
            }
        }
        private IEnumerable<String> GetEscapedIdentifier(IEnumerable<String> IdentifierValues)
        {
            foreach (var Identifier in IdentifierValues)
            {
                yield return GetEscapedIdentifier(Identifier);
            }
        }
        public IEnumerable<String> EventPump(List<ServerCommandDef> ServerCommands, String NamespaceName)
        {
            var ServerCommandGroups = ServerCommands.GroupBy(sc => sc.FullName()).Where(g => g.Any(sc => sc.Version == "")).ToList();
            yield return "class EventPump : public IEventPump";
            yield return "{";
            yield return "};";
            yield return "std::shared_ptr<IEventPump> CreateEventPump(std::function<std::function<std::wstring()>(std::vector<std::wstring>)> GetVersionResolver)";
            yield return "{";
            yield return "    auto ep = std::make_shared<EventPump>();";
            foreach (var g in ServerCommandGroups)
            {
                var c = g.Where(sc => sc.Version == "").First();
                var Name = c.GetTypeSpec().SimpleName(NamespaceName);
                var EventTypeString = GetSuffixedTypeString(c.Name, c.Version, "Event", NamespaceName);
                var GroupCommands = g.ToList();
                if (GroupCommands.Count == 1)
                {
                    foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Combine(Combine(Combine(Begin(), "ep->"), GetEscapedIdentifier(Name)), " = [=]("), EventTypeString), " e) { if ("), GetEscapedIdentifier(Name)), " != nullptr) { "), GetEscapedIdentifier(Name)), "(e); } };"))
                    {
                        yield return _Line == "" ? "" : "    " + _Line;
                    }
                }
                else
                {
                    var SortedGroupCommands = GroupCommands.Where(sc => sc.Version != "").OrderByDescending(sc => new NumericString(sc.Version)).ToList();
                    foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "auto "), GetEscapedIdentifier(Combine(Combine(Begin(), Name), "Resolver"))), " = GetVersionResolver({ "), String.Join(", ", SortedGroupCommands.Select(sc => GetEscapedStringLiteral(sc.Version)))), " });"))
                    {
                        yield return _Line == "" ? "" : "    " + _Line;
                    }
                    foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "ep->"), GetEscapedIdentifier(Name)), " = [=]("), EventTypeString), " eHead)"))
                    {
                        yield return _Line == "" ? "" : "    " + _Line;
                    }
                    yield return "    " + "{";
                    foreach (var _Line in Combine(Combine(Combine(Begin(), "    auto Version = "), GetEscapedIdentifier(Combine(Combine(Begin(), Name), "Resolver"))), "();"))
                    {
                        yield return _Line == "" ? "" : "    " + _Line;
                    }
                    yield return "    " + "    if (Version == L\"\")";
                    yield return "    " + "    {";
                    foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "        if ("), GetEscapedIdentifier(Name)), " != nullptr) { "), GetEscapedIdentifier(Name)), "(eHead); }"))
                    {
                        yield return _Line == "" ? "" : "    " + _Line;
                    }
                    yield return "    " + "        return;";
                    yield return "    " + "    }";
                    foreach (var sc in SortedGroupCommands)
                    {
                        var VersionedSimpleName = sc.GetTypeSpec().SimpleName(NamespaceName);
                        foreach (var _Line in Combine(Combine(Combine(Begin(), "if (Version == L\""), sc.Version), "\")"))
                        {
                            yield return _Line == "" ? "" : "        " + _Line;
                        }
                        yield return "        " + "{";
                        foreach (var _Line in Combine(Combine(Combine(Begin(), "    auto e = "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "EventFromHead"))), "(eHead);"))
                        {
                            yield return _Line == "" ? "" : "        " + _Line;
                        }
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "    if ("), GetEscapedIdentifier(VersionedSimpleName)), " != nullptr) { "), GetEscapedIdentifier(VersionedSimpleName)), "(e); }"))
                        {
                            yield return _Line == "" ? "" : "        " + _Line;
                        }
                        yield return "        " + "    return;";
                        yield return "        " + "}";
                    }
                    yield return "    " + "    throw std::logic_error(\"InvalidOperation\");";
                    yield return "    " + "};";
                }
            }
            yield return "    return ep;";
            yield return "}";
        }
        public IEnumerable<String> Translator_AliasFrom(String VersionedSimpleName, String TypeString, String VersionedTypeString, List<VariableDef> Fields, List<VariableDef> HeadFields, Boolean InitialHasError, String NamespaceName)
        {
            var d = HeadFields.ToDictionary(f => f.Name);
            var HasError = InitialHasError || !Fields.All(f => IsNullType(f.Type) || (d.ContainsKey(f.Name) && (IsSameType(f.Type, d[f.Name].Type, false) || IsSameType(f.Type, d[f.Name].Type, true))));
            if (HasError)
            {
                foreach (var _Line in Combine(Combine(Begin(), "//"), Translator_AliasFrom(VersionedSimpleName, TypeString, VersionedTypeString, Fields, HeadFields, NamespaceName)))
                {
                    yield return _Line;
                }
            }
            else
            {
                foreach (var _Line in Combine(Begin(), Translator_AliasFrom(VersionedSimpleName, TypeString, VersionedTypeString, Fields, HeadFields, NamespaceName)))
                {
                    yield return _Line;
                }
            }
        }
        public IEnumerable<String> Translator_AliasFrom(String VersionedSimpleName, String TypeString, String VersionedTypeString, List<VariableDef> Fields, List<VariableDef> HeadFields, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), VersionedTypeString), " "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "FromHead"))), "("), TypeString), " ho)"))
            {
                yield return _Line;
            }
            yield return "{";
            foreach (var _Line in Combine(Combine(Combine(Begin(), "    "), VersionedTypeString), " o;"))
            {
                yield return _Line;
            }
            var d = HeadFields.ToDictionary(f => f.Name);
            foreach (var f in Fields)
            {
                if (IsNullType(f.Type))
                {
                    foreach (var _Line in Combine(Combine(Combine(Begin(), "o."), GetEscapedIdentifier(f.Name)), " = Unit();"))
                    {
                        yield return _Line == "" ? "" : "    " + _Line;
                    }
                    continue;
                }
                if (d.ContainsKey(f.Name))
                {
                    var fHead = d[f.Name];
                    if (IsSameType(f.Type, fHead.Type, false))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "o."), GetEscapedIdentifier(f.Name)), " = ho."), GetEscapedIdentifier(f.Name)), ";"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        continue;
                    }
                    else if (IsSameType(f.Type, fHead.Type, true))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Combine(Begin(), "o."), GetEscapedIdentifier(f.Name)), " = "), GetEscapedIdentifier(Combine(Combine(Begin(), f.Type.SimpleName(NamespaceName)), "FromHead"))), "(ho."), GetEscapedIdentifier(f.Name)), ");"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        continue;
                    }
                }
                foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "o."), GetEscapedIdentifier(f.Name)), " = ho."), GetEscapedIdentifier(f.Name)), ";"))
                {
                    yield return _Line == "" ? "" : "    " + _Line;
                }
            }
            yield return "    return o;";
            yield return "}";
        }
        public IEnumerable<String> Translator_AliasTo(String VersionedSimpleName, String TypeString, String VersionedTypeString, List<VariableDef> Fields, List<VariableDef> HeadFields, Boolean InitialHasError, String NamespaceName)
        {
            var d = Fields.ToDictionary(f => f.Name);
            var HasError = InitialHasError || !HeadFields.All(fHead => IsNullType(fHead.Type) || (d.ContainsKey(fHead.Name) && (IsSameType(d[fHead.Name].Type, fHead.Type, false) || IsSameType(d[fHead.Name].Type, fHead.Type, true))));
            if (HasError)
            {
                foreach (var _Line in Combine(Combine(Begin(), "//"), Translator_AliasTo(VersionedSimpleName, TypeString, VersionedTypeString, Fields, HeadFields, NamespaceName)))
                {
                    yield return _Line;
                }
            }
            else
            {
                foreach (var _Line in Combine(Begin(), Translator_AliasTo(VersionedSimpleName, TypeString, VersionedTypeString, Fields, HeadFields, NamespaceName)))
                {
                    yield return _Line;
                }
            }
        }
        public IEnumerable<String> Translator_AliasTo(String VersionedSimpleName, String TypeString, String VersionedTypeString, List<VariableDef> Fields, List<VariableDef> HeadFields, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), TypeString), " "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "ToHead"))), "("), VersionedTypeString), " o)"))
            {
                yield return _Line;
            }
            yield return "{";
            foreach (var _Line in Combine(Combine(Combine(Begin(), "    "), TypeString), " ho;"))
            {
                yield return _Line;
            }
            var d = Fields.ToDictionary(f => f.Name);
            foreach (var fHead in HeadFields)
            {
                if (IsNullType(fHead.Type))
                {
                    foreach (var _Line in Combine(Combine(Combine(Begin(), "ho."), GetEscapedIdentifier(fHead.Name)), " = Unit();"))
                    {
                        yield return _Line == "" ? "" : "    " + _Line;
                    }
                    continue;
                }
                if (d.ContainsKey(fHead.Name))
                {
                    var f = d[fHead.Name];
                    if (IsSameType(f.Type, fHead.Type, false))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "ho."), GetEscapedIdentifier(f.Name)), " = o."), GetEscapedIdentifier(f.Name)), ";"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        continue;
                    }
                    else if (IsSameType(f.Type, fHead.Type, true))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Combine(Begin(), "ho."), GetEscapedIdentifier(f.Name)), " = "), GetEscapedIdentifier(Combine(Combine(Begin(), f.Type.SimpleName(NamespaceName)), "ToHead"))), "(o."), GetEscapedIdentifier(f.Name)), ");"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        continue;
                    }
                }
                foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "ho."), GetEscapedIdentifier(fHead.Name)), " = o."), GetEscapedIdentifier(fHead.Name)), ";"))
                {
                    yield return _Line == "" ? "" : "    " + _Line;
                }
            }
            yield return "    return ho;";
            yield return "}";
        }
        public IEnumerable<String> Translator_RecordFrom(String VersionedSimpleName, String TypeString, String VersionedTypeString, List<VariableDef> Fields, List<VariableDef> HeadFields, Boolean InitialHasError, String NamespaceName)
        {
            var d = HeadFields.ToDictionary(f => f.Name);
            var HasError = InitialHasError || !Fields.All(f => IsNullType(f.Type) || (d.ContainsKey(f.Name) && (IsSameType(f.Type, d[f.Name].Type, false) || IsSameType(f.Type, d[f.Name].Type, true))));
            if (HasError)
            {
                foreach (var _Line in Combine(Combine(Begin(), "//"), Translator_RecordFrom(VersionedSimpleName, TypeString, VersionedTypeString, Fields, HeadFields, NamespaceName)))
                {
                    yield return _Line;
                }
            }
            else
            {
                foreach (var _Line in Combine(Begin(), Translator_RecordFrom(VersionedSimpleName, TypeString, VersionedTypeString, Fields, HeadFields, NamespaceName)))
                {
                    yield return _Line;
                }
            }
        }
        public IEnumerable<String> Translator_RecordFrom(String VersionedSimpleName, String TypeString, String VersionedTypeString, List<VariableDef> Fields, List<VariableDef> HeadFields, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), VersionedTypeString), " "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "FromHead"))), "("), TypeString), " ho)"))
            {
                yield return _Line;
            }
            yield return "{";
            foreach (var _Line in Combine(Combine(Combine(Begin(), "    auto o = std::make_shared<"), VersionedTypeString), "::element_type>();"))
            {
                yield return _Line;
            }
            var d = HeadFields.ToDictionary(f => f.Name);
            foreach (var f in Fields)
            {
                if (IsNullType(f.Type))
                {
                    foreach (var _Line in Combine(Combine(Combine(Begin(), "o->"), GetEscapedIdentifier(f.Name)), " = Unit();"))
                    {
                        yield return _Line == "" ? "" : "    " + _Line;
                    }
                    continue;
                }
                if (d.ContainsKey(f.Name))
                {
                    var fHead = d[f.Name];
                    if (IsSameType(f.Type, fHead.Type, false))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "o->"), GetEscapedIdentifier(f.Name)), " = ho->"), GetEscapedIdentifier(f.Name)), ";"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        continue;
                    }
                    else if (IsSameType(f.Type, fHead.Type, true))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Combine(Begin(), "o->"), GetEscapedIdentifier(f.Name)), " = "), GetEscapedIdentifier(Combine(Combine(Begin(), f.Type.SimpleName(NamespaceName)), "FromHead"))), "(ho->"), GetEscapedIdentifier(f.Name)), ");"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        continue;
                    }
                }
                foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "o->"), GetEscapedIdentifier(f.Name)), " = ho->"), GetEscapedIdentifier(f.Name)), ";"))
                {
                    yield return _Line == "" ? "" : "    " + _Line;
                }
            }
            yield return "    return o;";
            yield return "}";
        }
        public IEnumerable<String> Translator_RecordTo(String VersionedSimpleName, String TypeString, String VersionedTypeString, List<VariableDef> Fields, List<VariableDef> HeadFields, Boolean InitialHasError, String NamespaceName)
        {
            var d = Fields.ToDictionary(f => f.Name);
            var HasError = InitialHasError || !HeadFields.All(fHead => IsNullType(fHead.Type) || (d.ContainsKey(fHead.Name) && (IsSameType(d[fHead.Name].Type, fHead.Type, false) || IsSameType(d[fHead.Name].Type, fHead.Type, true))));
            if (HasError)
            {
                foreach (var _Line in Combine(Combine(Begin(), "//"), Translator_RecordTo(VersionedSimpleName, TypeString, VersionedTypeString, Fields, HeadFields, NamespaceName)))
                {
                    yield return _Line;
                }
            }
            else
            {
                foreach (var _Line in Combine(Begin(), Translator_RecordTo(VersionedSimpleName, TypeString, VersionedTypeString, Fields, HeadFields, NamespaceName)))
                {
                    yield return _Line;
                }
            }
        }
        public IEnumerable<String> Translator_RecordTo(String VersionedSimpleName, String TypeString, String VersionedTypeString, List<VariableDef> Fields, List<VariableDef> HeadFields, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), TypeString), " "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "ToHead"))), "("), VersionedTypeString), " o)"))
            {
                yield return _Line;
            }
            yield return "{";
            foreach (var _Line in Combine(Combine(Combine(Begin(), "    auto ho = std::make_shared<"), TypeString), "::element_type>();"))
            {
                yield return _Line;
            }
            var d = Fields.ToDictionary(f => f.Name);
            foreach (var fHead in HeadFields)
            {
                if (IsNullType(fHead.Type))
                {
                    foreach (var _Line in Combine(Combine(Combine(Begin(), "ho->"), GetEscapedIdentifier(fHead.Name)), " = Unit();"))
                    {
                        yield return _Line == "" ? "" : "    " + _Line;
                    }
                    continue;
                }
                if (d.ContainsKey(fHead.Name))
                {
                    var f = d[fHead.Name];
                    if (IsSameType(f.Type, fHead.Type, false))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "ho->"), GetEscapedIdentifier(f.Name)), " = o->"), GetEscapedIdentifier(f.Name)), ";"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        continue;
                    }
                    else if (IsSameType(f.Type, fHead.Type, true))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Combine(Begin(), "ho->"), GetEscapedIdentifier(f.Name)), " = "), GetEscapedIdentifier(Combine(Combine(Begin(), f.Type.SimpleName(NamespaceName)), "ToHead"))), "(o->"), GetEscapedIdentifier(f.Name)), ");"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        continue;
                    }
                }
                foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "ho->"), GetEscapedIdentifier(fHead.Name)), " = o->"), GetEscapedIdentifier(fHead.Name)), ";"))
                {
                    yield return _Line == "" ? "" : "    " + _Line;
                }
            }
            yield return "    return ho;";
            yield return "}";
        }
        public IEnumerable<String> Translator_TaggedUnionFrom(String VersionedSimpleName, String TypeString, String VersionedTypeString, String RawVersionedTypeString, List<VariableDef> Alternatives, List<VariableDef> HeadAlternatives, Boolean InitialHasError, String NamespaceName)
        {
            var d = Alternatives.ToDictionary(a => a.Name);
            var HasError = InitialHasError || !HeadAlternatives.All(aHead => d.ContainsKey(aHead.Name) && (IsNullType(d[aHead.Name].Type) || IsSameType(d[aHead.Name].Type, aHead.Type, false) || IsSameType(d[aHead.Name].Type, aHead.Type, true)));
            if (HasError)
            {
                foreach (var _Line in Combine(Combine(Begin(), "//"), Translator_TaggedUnionFrom(VersionedSimpleName, TypeString, VersionedTypeString, RawVersionedTypeString, Alternatives, HeadAlternatives, NamespaceName)))
                {
                    yield return _Line;
                }
            }
            else
            {
                foreach (var _Line in Combine(Begin(), Translator_TaggedUnionFrom(VersionedSimpleName, TypeString, VersionedTypeString, RawVersionedTypeString, Alternatives, HeadAlternatives, NamespaceName)))
                {
                    yield return _Line;
                }
            }
        }
        public IEnumerable<String> Translator_TaggedUnionFrom(String VersionedSimpleName, String TypeString, String VersionedTypeString, String RawVersionedTypeString, List<VariableDef> Alternatives, List<VariableDef> HeadAlternatives, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), VersionedTypeString), " "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "FromHead"))), "("), TypeString), " ho)"))
            {
                yield return _Line;
            }
            yield return "{";
            var d = Alternatives.ToDictionary(a => a.Name);
            foreach (var aHead in HeadAlternatives)
            {
                if (d.ContainsKey(aHead.Name))
                {
                    var a = d[aHead.Name];
                    if (IsNullType(a.Type))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Begin(), "if (ho->"), GetEscapedIdentifier(Combine(Combine(Begin(), "On"), a.Name))), "())"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        yield return "    " + "{";
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "    return "), RawVersionedTypeString), "::"), GetEscapedIdentifier(Combine(Combine(Begin(), "Create"), a.Name))), "();"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        yield return "    " + "}";
                        continue;
                    }
                    else if (IsSameType(a.Type, aHead.Type, false))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Begin(), "if (ho->"), GetEscapedIdentifier(Combine(Combine(Begin(), "On"), a.Name))), "())"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        yield return "    " + "{";
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Combine(Begin(), "    return "), RawVersionedTypeString), "::"), GetEscapedIdentifier(Combine(Combine(Begin(), "Create"), a.Name))), "(ho->"), GetEscapedIdentifier(a.Name)), ");"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        yield return "    " + "}";
                        continue;
                    }
                    else if (IsSameType(a.Type, aHead.Type, true))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Begin(), "if (ho->"), GetEscapedIdentifier(Combine(Combine(Begin(), "On"), a.Name))), "())"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        yield return "    " + "{";
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Combine(Combine(Combine(Begin(), "    return "), RawVersionedTypeString), "::"), GetEscapedIdentifier(Combine(Combine(Begin(), "Create"), a.Name))), "("), GetEscapedIdentifier(Combine(Combine(Begin(), a.Type.SimpleName(NamespaceName)), "FromHead"))), "(ho->"), GetEscapedIdentifier(a.Name)), "));"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        yield return "    " + "}";
                        continue;
                    }
                }
                foreach (var _Line in Combine(Combine(Combine(Begin(), "if (ho->"), GetEscapedIdentifier(Combine(Combine(Begin(), "On"), aHead.Name))), "())"))
                {
                    yield return _Line == "" ? "" : "    " + _Line;
                }
                yield return "    " + "{";
                foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Combine(Begin(), "    return "), RawVersionedTypeString), "::"), GetEscapedIdentifier(Combine(Combine(Begin(), "Create"), aHead.Name))), "(ho->"), GetEscapedIdentifier(aHead.Name)), ");"))
                {
                    yield return _Line == "" ? "" : "    " + _Line;
                }
                yield return "    " + "}";
            }
            yield return "    throw std::logic_error(\"InvalidOperation\");";
            yield return "}";
        }
        public IEnumerable<String> Translator_TaggedUnionTo(String VersionedSimpleName, String TypeString, String VersionedTypeString, String RawTypeString, List<VariableDef> Alternatives, List<VariableDef> HeadAlternatives, Boolean InitialHasError, String NamespaceName)
        {
            var d = Alternatives.ToDictionary(a => a.Name);
            var HasError = InitialHasError || !HeadAlternatives.All(aHead => d.ContainsKey(aHead.Name) && (IsNullType(aHead.Type) || IsSameType(d[aHead.Name].Type, aHead.Type, false) || IsSameType(d[aHead.Name].Type, aHead.Type, true)));
            if (HasError)
            {
                foreach (var _Line in Combine(Combine(Begin(), "//"), Translator_TaggedUnionTo(VersionedSimpleName, TypeString, VersionedTypeString, RawTypeString, Alternatives, HeadAlternatives, NamespaceName)))
                {
                    yield return _Line;
                }
            }
            else
            {
                foreach (var _Line in Combine(Begin(), Translator_TaggedUnionTo(VersionedSimpleName, TypeString, VersionedTypeString, RawTypeString, Alternatives, HeadAlternatives, NamespaceName)))
                {
                    yield return _Line;
                }
            }
        }
        public IEnumerable<String> Translator_TaggedUnionTo(String VersionedSimpleName, String TypeString, String VersionedTypeString, String RawTypeString, List<VariableDef> Alternatives, List<VariableDef> HeadAlternatives, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), TypeString), " "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "ToHead"))), "("), VersionedTypeString), " o)"))
            {
                yield return _Line;
            }
            yield return "{";
            var d = Alternatives.ToDictionary(a => a.Name);
            foreach (var aHead in HeadAlternatives)
            {
                if (d.ContainsKey(aHead.Name))
                {
                    var a = d[aHead.Name];
                    if (IsNullType(aHead.Type))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Begin(), "if (o->"), GetEscapedIdentifier(Combine(Combine(Begin(), "On"), a.Name))), "())"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        yield return "    " + "{";
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "    return "), RawTypeString), "::"), GetEscapedIdentifier(Combine(Combine(Begin(), "Create"), a.Name))), "();"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        yield return "    " + "}";
                        continue;
                    }
                    else if (IsSameType(a.Type, aHead.Type, false))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Begin(), "if (o->"), GetEscapedIdentifier(Combine(Combine(Begin(), "On"), a.Name))), "())"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        yield return "    " + "{";
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Combine(Begin(), "    return "), RawTypeString), "::"), GetEscapedIdentifier(Combine(Combine(Begin(), "Create"), a.Name))), "(o->"), GetEscapedIdentifier(a.Name)), ");"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        yield return "    " + "}";
                        continue;
                    }
                    else if (IsSameType(a.Type, aHead.Type, true))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Begin(), "if (o->"), GetEscapedIdentifier(Combine(Combine(Begin(), "On"), a.Name))), "())"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        yield return "    " + "{";
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Combine(Combine(Combine(Begin(), "    return "), RawTypeString), "::"), GetEscapedIdentifier(Combine(Combine(Begin(), "Create"), a.Name))), "("), GetEscapedIdentifier(Combine(Combine(Begin(), a.Type.SimpleName(NamespaceName)), "ToHead"))), "(o->"), GetEscapedIdentifier(a.Name)), "));"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        yield return "    " + "}";
                        continue;
                    }
                }
                foreach (var _Line in Combine(Combine(Combine(Begin(), "if (o->"), GetEscapedIdentifier(Combine(Combine(Begin(), "On"), aHead.Name))), "())"))
                {
                    yield return _Line == "" ? "" : "    " + _Line;
                }
                yield return "    " + "{";
                foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Combine(Begin(), "    return "), RawTypeString), "::"), GetEscapedIdentifier(Combine(Combine(Begin(), "Create"), aHead.Name))), "(o->"), GetEscapedIdentifier(aHead.Name)), ");"))
                {
                    yield return _Line == "" ? "" : "    " + _Line;
                }
                yield return "    " + "}";
            }
            yield return "    throw std::logic_error(\"InvalidOperation\");";
            yield return "}";
        }
        public IEnumerable<String> Translator_EnumFrom(String VersionedSimpleName, String TypeString, String VersionedTypeString, String RawTypeString, String RawVersionedTypeString, List<LiteralDef> Literals, List<LiteralDef> HeadLiterals, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), VersionedTypeString), " "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "FromHead"))), "("), TypeString), " ho)"))
            {
                yield return _Line;
            }
            yield return "{";
            foreach (var ltl in HeadLiterals)
            {
                foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "if (ho == "), RawTypeString), "::"), GetEscapedIdentifier(ltl.Name)), ")"))
                {
                    yield return _Line == "" ? "" : "    " + _Line;
                }
                yield return "    " + "{";
                foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "    return "), RawVersionedTypeString), "::"), GetEscapedIdentifier(ltl.Name)), ";"))
                {
                    yield return _Line == "" ? "" : "    " + _Line;
                }
                yield return "    " + "}";
            }
            yield return "    throw std::logic_error(\"InvalidOperation\");";
            yield return "}";
        }
        public IEnumerable<String> Translator_EnumTo(String VersionedSimpleName, String TypeString, String VersionedTypeString, String RawTypeString, String RawVersionedTypeString, List<LiteralDef> Literals, List<LiteralDef> HeadLiterals, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), TypeString), " "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "ToHead"))), "("), VersionedTypeString), " o)"))
            {
                yield return _Line;
            }
            yield return "{";
            foreach (var ltl in Literals)
            {
                foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "if (o == "), RawVersionedTypeString), "::"), GetEscapedIdentifier(ltl.Name)), ")"))
                {
                    yield return _Line == "" ? "" : "    " + _Line;
                }
                yield return "    " + "{";
                foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "    return "), RawTypeString), "::"), GetEscapedIdentifier(ltl.Name)), ";"))
                {
                    yield return _Line == "" ? "" : "    " + _Line;
                }
                yield return "    " + "}";
            }
            yield return "    throw std::logic_error(\"InvalidOperation\");";
            yield return "}";
        }
        public IEnumerable<String> Translator_ClientCommand(String SimpleName, String VersionedSimpleName, String RequestTypeString, String ReplyTypeString, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), ReplyTypeString), " "), GetEscapedIdentifier(VersionedSimpleName)), "("), RequestTypeString), " r)"))
            {
                yield return _Line;
            }
            yield return "{";
            foreach (var _Line in Combine(Combine(Combine(Begin(), "    auto HeadRequest = "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "RequestToHead"))), "(r);"))
            {
                yield return _Line;
            }
            foreach (var _Line in Combine(Combine(Combine(Begin(), "    auto HeadReply = "), GetEscapedIdentifier(SimpleName)), "(HeadRequest);"))
            {
                yield return _Line;
            }
            foreach (var _Line in Combine(Combine(Combine(Begin(), "    auto Reply = "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "ReplyFromHead"))), "(HeadReply);"))
            {
                yield return _Line;
            }
            yield return "    return Reply;";
            yield return "}";
        }
        public IEnumerable<String> Translator_ClientCommandAsync(String SimpleName, String VersionedSimpleName, String RequestTypeString, String ReplyTypeString, String UnversionedReplyTypeString, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Combine(Begin(), "void "), GetEscapedIdentifier(VersionedSimpleName)), "("), RequestTypeString), " r, std::function<void("), ReplyTypeString), ")> Callback, std::function<void(const std::exception &)> OnFailure)"))
            {
                yield return _Line;
            }
            yield return "{";
            foreach (var _Line in Combine(Combine(Combine(Begin(), "    auto HeadRequest = "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "RequestToHead"))), "(r);"))
            {
                yield return _Line;
            }
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Combine(Begin(), "    "), GetEscapedIdentifier(SimpleName)), "(HeadRequest, [=]("), UnversionedReplyTypeString), " HeadReply) { Callback("), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "ReplyFromHead"))), "(HeadReply)); }, OnFailure);"))
            {
                yield return _Line;
            }
            yield return "}";
        }
        public IEnumerable<String> Translator_TupleFrom(String VersionedSimpleName, String TypeString, String VersionedTypeString, List<TypeSpec> Elements, List<TypeSpec> HeadElements, Boolean InitialHasError, String NamespaceName)
        {
            var HasError = InitialHasError || (Elements.Count != HeadElements.Count) || !Elements.Zip(HeadElements, (e, eHead) => IsNullType(e) || IsSameType(e, eHead, false) || IsSameType(e, eHead, true)).All(b => b);
            if (HasError)
            {
                foreach (var _Line in Combine(Combine(Begin(), "//"), Translator_TupleFrom(VersionedSimpleName, TypeString, VersionedTypeString, Elements, HeadElements, NamespaceName)))
                {
                    yield return _Line;
                }
            }
            else
            {
                foreach (var _Line in Combine(Begin(), Translator_TupleFrom(VersionedSimpleName, TypeString, VersionedTypeString, Elements, HeadElements, NamespaceName)))
                {
                    yield return _Line;
                }
            }
        }
        public IEnumerable<String> Translator_TupleFrom(String VersionedSimpleName, String TypeString, String VersionedTypeString, List<TypeSpec> Elements, List<TypeSpec> HeadElements, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), VersionedTypeString), " "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "FromHead"))), "("), TypeString), " ho)"))
            {
                yield return _Line;
            }
            yield return "{";
            var k = 0;
            foreach (var e in Elements)
            {
                if (IsNullType(e))
                {
                    foreach (var _Line in Combine(Combine(Combine(Begin(), "auto Item"), k + 1), " = Unit();"))
                    {
                        yield return _Line == "" ? "" : "    " + _Line;
                    }
                    k += 1;
                    continue;
                }
                if (k < HeadElements.Count)
                {
                    var eHead = HeadElements[k];
                    if (IsSameType(e, eHead, false))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "auto Item"), k), " = std::get<"), k), ">(ho);"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        k += 1;
                        continue;
                    }
                    else if (IsSameType(e, eHead, true))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Combine(Begin(), "auto Item"), k), " = "), GetEscapedIdentifier(Combine(Combine(Begin(), e.SimpleName(NamespaceName)), "FromHead"))), "(std::get<"), k), ">(ho));"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        k += 1;
                        continue;
                    }
                }
                foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "auto Item"), k), " = std::get<"), k), ">(ho);"))
                {
                    yield return _Line == "" ? "" : "    " + _Line;
                }
                k += 1;
            }
            foreach (var _Line in Combine(Combine(Combine(Begin(), "    return std::make_tuple("), String.Join(", ", Enumerable.Range(0, Elements.Count).Select(i => "Item" + i.ToInvariantString()))), ");"))
            {
                yield return _Line;
            }
            yield return "}";
        }
        public IEnumerable<String> Translator_TupleTo(String VersionedSimpleName, String TypeString, String VersionedTypeString, List<TypeSpec> Elements, List<TypeSpec> HeadElements, Boolean InitialHasError, String NamespaceName)
        {
            var HasError = InitialHasError || (Elements.Count != HeadElements.Count) || !Elements.Zip(HeadElements, (e, eHead) => IsNullType(e) || IsSameType(e, eHead, false) || IsSameType(e, eHead, true)).All(b => b);
            if (HasError)
            {
                foreach (var _Line in Combine(Combine(Begin(), "//"), Translator_TupleTo(VersionedSimpleName, TypeString, VersionedTypeString, Elements, HeadElements, NamespaceName)))
                {
                    yield return _Line;
                }
            }
            else
            {
                foreach (var _Line in Combine(Begin(), Translator_TupleTo(VersionedSimpleName, TypeString, VersionedTypeString, Elements, HeadElements, NamespaceName)))
                {
                    yield return _Line;
                }
            }
        }
        public IEnumerable<String> Translator_TupleTo(String VersionedSimpleName, String TypeString, String VersionedTypeString, List<TypeSpec> Elements, List<TypeSpec> HeadElements, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), TypeString), " "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "ToHead"))), "("), VersionedTypeString), " o)"))
            {
                yield return _Line;
            }
            yield return "{";
            var k = 0;
            foreach (var eHead in HeadElements)
            {
                if (IsNullType(eHead))
                {
                    foreach (var _Line in Combine(Combine(Combine(Begin(), "auto Item"), k), " = Unit();"))
                    {
                        yield return _Line == "" ? "" : "    " + _Line;
                    }
                    k += 1;
                    continue;
                }
                if (k < Elements.Count)
                {
                    var e = Elements[k];
                    if (IsSameType(e, eHead, false))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "auto Item"), k), " = std::get<"), k), ">(o);"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        k += 1;
                        continue;
                    }
                    else if (IsSameType(e, eHead, true))
                    {
                        foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Combine(Begin(), "auto Item"), k), " = "), GetEscapedIdentifier(Combine(Combine(Begin(), e.SimpleName(NamespaceName)), "ToHead"))), "(std::get<"), k), ">(o));"))
                        {
                            yield return _Line == "" ? "" : "    " + _Line;
                        }
                        k += 1;
                        continue;
                    }
                }
                foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Begin(), "auto Item"), k), " = std::get<"), k), ">(o);"))
                {
                    yield return _Line == "" ? "" : "    " + _Line;
                }
                k += 1;
            }
            foreach (var _Line in Combine(Combine(Combine(Begin(), "    return std::make_tuple("), String.Join(", ", Enumerable.Range(0, Elements.Count).Select(i => "Item" + i.ToInvariantString()))), ");"))
            {
                yield return _Line;
            }
            yield return "}";
        }
        public IEnumerable<String> Translator_ListFrom(String VersionedSimpleName, String TypeString, String VersionedTypeString, String VersionedElementSimpleName, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), VersionedTypeString), " "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "FromHead"))), "("), TypeString), " ho)"))
            {
                yield return _Line;
            }
            yield return "{";
            foreach (var _Line in Combine(Combine(Combine(Begin(), "    "), VersionedTypeString), " l;"))
            {
                yield return _Line;
            }
            yield return "    for (auto he : ho)";
            yield return "    {";
            foreach (var _Line in Combine(Combine(Combine(Begin(), "        l.push_back("), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedElementSimpleName), "FromHead"))), "(he));"))
            {
                yield return _Line;
            }
            yield return "    }";
            yield return "    return l;";
            yield return "}";
        }
        public IEnumerable<String> Translator_ListTo(String VersionedSimpleName, String TypeString, String VersionedTypeString, String VersionedElementSimpleName, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), TypeString), " "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "ToHead"))), "("), VersionedTypeString), " o)"))
            {
                yield return _Line;
            }
            yield return "{";
            foreach (var _Line in Combine(Combine(Combine(Begin(), "    "), TypeString), " l;"))
            {
                yield return _Line;
            }
            yield return "    for (auto e : o)";
            yield return "    {";
            foreach (var _Line in Combine(Combine(Combine(Begin(), "        l.push_back("), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedElementSimpleName), "ToHead"))), "(e));"))
            {
                yield return _Line;
            }
            yield return "    }";
            yield return "    return l;";
            yield return "}";
        }
        public IEnumerable<String> Translator_SetFrom(String VersionedSimpleName, String TypeString, String VersionedTypeString, String VersionedElementSimpleName, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), VersionedTypeString), " "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "FromHead"))), "("), TypeString), " ho)"))
            {
                yield return _Line;
            }
            yield return "{";
            foreach (var _Line in Combine(Combine(Combine(Begin(), "    "), VersionedTypeString), " s;"))
            {
                yield return _Line;
            }
            yield return "    for (auto he : ho)";
            yield return "    {";
            foreach (var _Line in Combine(Combine(Combine(Begin(), "        s.insert("), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedElementSimpleName), "FromHead"))), "(he));"))
            {
                yield return _Line;
            }
            yield return "    }";
            yield return "    return s;";
            yield return "}";
        }
        public IEnumerable<String> Translator_SetTo(String VersionedSimpleName, String TypeString, String VersionedTypeString, String VersionedElementSimpleName, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), TypeString), " "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "ToHead"))), "("), VersionedTypeString), " o)"))
            {
                yield return _Line;
            }
            yield return "{";
            foreach (var _Line in Combine(Combine(Combine(Begin(), "    "), TypeString), " s;"))
            {
                yield return _Line;
            }
            yield return "    for (auto e : o)";
            yield return "    {";
            foreach (var _Line in Combine(Combine(Combine(Begin(), "        s.insert("), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedElementSimpleName), "ToHead"))), "(e));"))
            {
                yield return _Line;
            }
            yield return "    }";
            yield return "    return s;";
            yield return "}";
        }
        public IEnumerable<String> Translator_MapFrom(String VersionedSimpleName, String TypeString, String VersionedTypeString, TypeSpec KeyTypeSpec, TypeSpec HeadKeyTypeSpec, TypeSpec ValueTypeSpec, TypeSpec HeadValueTypeSpec, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), VersionedTypeString), " "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "FromHead"))), "("), TypeString), " ho)"))
            {
                yield return _Line;
            }
            yield return "{";
            foreach (var _Line in Combine(Combine(Combine(Begin(), "    "), VersionedTypeString), " o;"))
            {
                yield return _Line;
            }
            yield return "    for (auto hp : ho)";
            yield return "    {";
            if (IsSameType(KeyTypeSpec, HeadKeyTypeSpec, false))
            {
                yield return "        " + "auto Key = std::get<0>(hp);";
            }
            else
            {
                foreach (var _Line in Combine(Combine(Combine(Begin(), "auto Key = "), GetEscapedIdentifier(Combine(Combine(Begin(), KeyTypeSpec.SimpleName(NamespaceName)), "FromHead"))), "(std::get<0>(hp));"))
                {
                    yield return _Line == "" ? "" : "        " + _Line;
                }
            }
            if (IsSameType(ValueTypeSpec, HeadValueTypeSpec, false))
            {
                yield return "        " + "auto Value = std::get<1>(hp);";
            }
            else
            {
                foreach (var _Line in Combine(Combine(Combine(Begin(), "auto Value = "), GetEscapedIdentifier(Combine(Combine(Begin(), ValueTypeSpec.SimpleName(NamespaceName)), "FromHead"))), "(std::get<1>(hp));"))
                {
                    yield return _Line == "" ? "" : "        " + _Line;
                }
            }
            yield return "        o[Key] = Value;";
            yield return "    }";
            yield return "    return o;";
            yield return "}";
        }
        public IEnumerable<String> Translator_MapTo(String VersionedSimpleName, String TypeString, String VersionedTypeString, TypeSpec KeyTypeSpec, TypeSpec HeadKeyTypeSpec, TypeSpec ValueTypeSpec, TypeSpec HeadValueTypeSpec, String NamespaceName)
        {
            foreach (var _Line in Combine(Combine(Combine(Combine(Combine(Combine(Begin(), TypeString), " "), GetEscapedIdentifier(Combine(Combine(Begin(), VersionedSimpleName), "ToHead"))), "("), VersionedTypeString), " o)"))
            {
                yield return _Line;
            }
            yield return "{";
            foreach (var _Line in Combine(Combine(Combine(Begin(), "    "), TypeString), " ho;"))
            {
                yield return _Line;
            }
            yield return "    for (auto p : o)";
            yield return "    {";
            if (IsSameType(KeyTypeSpec, HeadKeyTypeSpec, false))
            {
                yield return "        " + "auto Key = std::get<0>(p);";
            }
            else
            {
                foreach (var _Line in Combine(Combine(Combine(Begin(), "auto Key = "), GetEscapedIdentifier(Combine(Combine(Begin(), KeyTypeSpec.SimpleName(NamespaceName)), "ToHead"))), "(std::get<0>(p));"))
                {
                    yield return _Line == "" ? "" : "        " + _Line;
                }
            }
            if (IsSameType(ValueTypeSpec, HeadValueTypeSpec, false))
            {
                yield return "        " + "auto Value = std::get<1>(p);";
            }
            else
            {
                foreach (var _Line in Combine(Combine(Combine(Begin(), "auto Value = "), GetEscapedIdentifier(Combine(Combine(Begin(), ValueTypeSpec.SimpleName(NamespaceName)), "ToHead"))), "(std::get<1>(p));"))
                {
                    yield return _Line == "" ? "" : "        " + _Line;
                }
            }
            yield return "        ho[Key] = Value;";
            yield return "    }";
            yield return "    return ho;";
            yield return "}";
        }
        public IEnumerable<String> WrapPartialClass(String ClassName, IEnumerable<String> Contents)
        {
            foreach (var _Line in Combine(Combine(Begin(), "/* partial */ class "), GetEscapedIdentifier(ClassName)))
            {
                yield return _Line;
            }
            yield return "{";
            yield return "public:";
            foreach (var _Line in Combine(Combine(Begin(), "    "), Contents))
            {
                yield return _Line;
            }
            yield return "};";
        }
        public IEnumerable<String> Main(Schema Schema, String NamespaceName, String ImplementationNamespaceName, String ImplementationClassName)
        {
            yield return "//==========================================================================";
            yield return "//";
            yield return "//  Notice:      This file is automatically generated.";
            yield return "//               Please don't modify this file.";
            yield return "//";
            yield return "//==========================================================================";
            yield return "";
            yield return "#pragma once";
            yield return "";
            yield return "#include <cstddef>";
            yield return "#include <cstdint>";
            yield return "#include <string>";
            yield return "#include <vector>";
            yield return "#include <unordered_set>";
            yield return "#include <unordered_map>";
            yield return "#include <tuple>";
            yield return "#include <memory>";
            yield return "#include <functional>";
            yield return "#include <exception>";
            yield return "#include <stdexcept>";
            foreach (var _Line in Combine(Combine(Begin(), "#include "), Schema.Imports.Where(i => IsInclude(i))))
            {
                yield return _Line;
            }
            if (NamespaceName != "")
            {
                foreach (var _Line in Combine(Combine(Combine(Begin(), "using namespace "), NamespaceName), ";"))
                {
                    yield return _Line;
                }
            }
            yield return "";
            foreach (var _Line in Combine(Begin(), GetTypes(Schema, NamespaceName, ImplementationNamespaceName, ImplementationClassName)))
            {
                yield return _Line;
            }
            yield return "";
        }
    }
}
