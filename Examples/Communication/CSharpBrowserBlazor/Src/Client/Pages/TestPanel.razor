@page "/testpanel"
@using System.Net.Http.Json;
@using Communication
@using Communication.Json
@using Client
@inject HttpClient hc
@inject IApplicationClient ac
@inject IJSRuntime JS

<p><button class="btn btn-primary" @onclick="ButtonAlertClicked">Test Alert</button></p>

<p>
    <button class="btn btn-primary" @onclick="ButtonTemplateClicked">Test Template</button>
    <div>
        <table class="table">
            <tbody>
                @foreach (var user in users)
                {
                    <tr><td>@user.id</td><td>@user.name</td></tr>
                }
            </tbody>
        </table>
    </div>
</p>

<p>
    <button class="btn btn-primary" @onclick="ButtonAjaxClicked">Test AJAX</button>
    <div>
        <table class="table">
            <tbody>
                @foreach (var user in usersAjax)
                {
                    <tr><td>@user.id</td><td>@user.name</td></tr>
                }
            </tbody>
        </table>
    </div>
</p>

<p>
    <button class="btn btn-primary" @onclick="ButtonServerTimeClicked">Test ServerTime</button>
    <p>@serverTime</p>
</p>

@code {
    #pragma warning disable 8618

    public class User
    {
        public String id { get; init; }
        public String name { get; init; }
    }

    List<User> users = new List<User> { };
    List<User> usersAjax = new List<User> { };
    String serverTime = "";

    protected override async Task OnInitializedAsync()
    {
        await Task.FromResult(0);
    }

    async Task ButtonAlertClicked()
    {
        await JS.InvokeAsync<object>("alert", new object[] { "Test Alert Message" });
    }
    void ButtonTemplateClicked()
    {
        users.AddRange(new User[] { new User { id = "zhang3", name = "ZHANG San" }, new User { id = "li4", name = "LI Si" } });
    }
    async Task ButtonAjaxClicked()
    {
        usersAjax.AddRange((await hc.GetFromJsonAsync<User[]>("users.json"))!);
    }

    async Task ButtonServerTimeClicked()
    {
        var r = await ac.ServerTime(new ServerTimeRequest { });
        Console.WriteLine("test2");
        if (r.OnSuccess)
        {
            serverTime = r.Success;
        }
    }
}
